/*
 * ************************************************************************
 *
 *  ADOBE CONFIDENTIAL
 *  ___________________
 *
 *   (c) Copyright 2014 Adobe Systems Incorporated
 *   All Rights Reserved.
 *
 *  NOTICE:  All information contained herein is, and remains
 *  the property of Adobe Systems Incorporated and its suppliers,
 *  if any.  The intellectual and technical concepts contained
 *  herein are proprietary to Adobe Systems Incorporated and its
 *  suppliers and may be covered by U.S. and Foreign Patents,
 *  patents in process, and are protected by trade secret or copyright law.
 *  Dissemination of this information or reproduction of this material
 *  is strictly forbidden unless prior written permission is obtained
 *  from Adobe Systems Incorporated.
 * ************************************************************************
 */

/*
 * video heartbeats - v1.2.0 - 2014-08-20
 * Copyright (c) 2014 Adobe Systems, Inc. All Rights Reserved.
 */
 (function(t){if(e===void 0)var e={};if(i===void 0)var i={};(function(t){"use strict";function e(t,e){function i(){this.constructor=t}for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t}t.extend=e})(e),function(t){"use strict";function e(t,e){var i=[];for(var a in e)e.hasOwnProperty(a)&&"function"==typeof e[a]&&i.push(a);for(var n=0;i.length>n;n++){var s=i[n];t.prototype[s]=e[s]}}t.mixin=e}(e),function(t){"use strict";t.deferrable={executeDeferred:function(){this._deferred&&this._deferred.apply(this,arguments),this._deferred=null}}}(e),function(t){"use strict";t.LOGGING_ENABLED=!1,t.logger={enableLogging:function(t){this._logEnabled=!0,this._logTag=t},disableLogging:function(){this._logEnabled=!1},log:function(e){t.LOGGING_ENABLED&&this._logEnabled&&window.console&&window.console.log&&window.console.log(this._logTag+e)},info:function(e){t.LOGGING_ENABLED&&this._logEnabled&&window.console&&window.console.info&&window.console.info(this._logTag+e)},warn:function(e){t.LOGGING_ENABLED&&this._logEnabled&&window.console&&window.console.warn&&window.console.warn(this._logTag+e)},error:function(e){if(t.LOGGING_ENABLED&&this._logEnabled&&window.console&&window.console.error)throw e=this._logTag+e,window.console.error(e),Error(e)}}}(e),function(t){"use strict";function e(t,e){this.type=t,this.data=e}e.SUCCESS="success",e.ERROR="error",t.Event=e}(e),function(t){"use strict";function e(){this._events={}}e.prototype.addEventListener=function(t,e,i){t&&e&&(i=i||window,this._events[t]=this._events[t]||[],this._events[t].push({cb:e,ctx:i}))},e.prototype.removeEventListener=function(t,e,i){if(t&&e){i=i||window;var a,n,s=!1;for(n in this._events)if(t===n){s=!0;break}if(s){for(a=this._events[n].length-1;a>=0;a--){var r=this._events[n][a];e===r.cb&&i===r.ctx&&this._events[n].splice(a,1)}this._events[n].length||delete this._events[n]}}},e.prototype.dispatchEvent=function(t){if(t.type){var e,i;for(e in this._events)if(this._events.hasOwnProperty(e)&&t.type===e){var a=this._events[e];for(i=0;a.length>i;i++)a[i].cb.call(a[i].ctx,t);break}}},e.prototype.removeAllListeners=function(t){if(t){var e,i;for(i in this._events)if(this._events.hasOwnProperty(i)){for(e=this._events[i].length-1;e>=0;e--){var a=this._events[i][e];a.ctx===t&&this._events[i].splice(e,1)}this._events[i].length||delete this._events[i]}}else this._events={}},t.EventDispatcher=e}(e),function(t){"use strict";function e(){}function i(t,e){this.url=t||null,this.method=e,this._xmlhttp=null}function a(){a.__super__.constructor.call(this),this._connection=null}var n=t.Event,s=t.EventDispatcher;e.GET="GET",a.RESPONSE="response",a.INSTANCE="instance",t.extend(a,s),a.prototype._createCORSRequest=function(e){var i=null;if(window.XMLHttpRequest!==void 0){var s=new window.XMLHttpRequest;"withCredentials"in s&&(i=s,i.open(e.method,e.url,!0))}if(null==i&&window.XDomainRequest!==void 0&&(i=new window.XDomainRequest,i.open(e.method,e.url)),i){var r={};r[a.INSTANCE]=this;var o=this;i.onload=function(){return i.status&&parseInt(i.status,10)>=400?this.onerror():(r[a.RESPONSE]=i.responseText,o.dispatchEvent(new n(n.SUCCESS,r)),void 0)},i.onerror=function(){o.dispatchEvent(new t.Event(n.ERROR,r))}}return i},a.prototype._loadImage=function(e){this._connection||(this._connection=new Image,this._connection.alt=""),this._connection.src=e.url;var i={};i[a.RESPONSE]="",i[a.INSTANCE]=this,this.dispatchEvent(new t.Event(n.SUCCESS,i))},a.prototype.close=function(){this.removeAllListeners()},a.prototype.load=function(t){t&&t.method&&t.url&&(t._xmlhttp=this._createCORSRequest(t),t._xmlhttp?t._xmlhttp.send():this._loadImage(t))},t.URLRequestMethod=e,t.URLRequest=i,t.URLLoader=a}(e),function(t){"use strict";function e(){this.enableLogging("[as-js-bridge::VisitorBridge] > "),this._getVisitorInstance=function(t){var i=e.instances[t];return i||this.error("Unable to find visitor for "+t+"."),i},this.onCreate=function(t,i){this.log("("+t+")"+"Bridge created."),e.instances[t]||(this.log("("+t+")"+"Creating a Visitor instance."),e.instances[t]=new Visitor(i.marketingCloudOrgId,i.namespace))},this.onSetTrackingServer=function(t,e){this.log("("+t+")"+"Setting tracking server.");var i=this._getVisitorInstance(t);i.trackingServer=e.trackingServer},e.instances={}}var a=t.mixin,n=t.logger;window.Visitor,a(e,n),i.VisitorBridge=e,i.visitorBridge=new e}(e),function(t){"use strict";function e(){this.enableLogging("[as-js-bridge::AppMeasurementBridge] > "),this._getAppMeasurementInstance=function(t){var i=e.instances[t];return i||this.error("Unable to find app measurement for "+t+"."),i},this.onCreate=function(t,i){if(this.log("("+t+")"+"Bridge created."),!e.instances[t]){this.log("("+t+")"+"Creating an AppMeasurement instance.");var a=r.instances[t];a||this.error("Unable to find visitor for "+t+".");var n=s.getInstance(i.account);n.visitor=a,e.instances[t]=n}},this.onSetTrackingServer=function(t,e){this.log("("+t+")"+"Set tracking server: "+e.trackingServer);var i=this._getAppMeasurementInstance(t);i.trackingServer=e.trackingServer},this.onSetPageName=function(t,e){this.log("("+t+")"+"Set page name: "+e.pageName);var i=this._getAppMeasurementInstance(t);i.pageName=e.pageName},this.onSetSSL=function(t,e){this.log("("+t+")"+"Set SSL: "+e.ssl);var i=this._getAppMeasurementInstance(t);i.ssl=e.ssl},this.onSetAccount=function(t,e){this.log("("+t+")"+"Set account: "+e.account);var i=this._getAppMeasurementInstance(t);i.account=e.account},this.onSetVisitorNamespace=function(t,e){this.log("("+t+")"+"Set visitorNamespace: "+e.visitorNamespace);var i=this._getAppMeasurementInstance(t);i.visitorNamespace=e.visitorNamespace},this.onSetCharSet=function(t,e){this.log("("+t+")"+"Set charSet: "+e.charSet);var i=this._getAppMeasurementInstance(t);i.charSet=e.charSet},this.onSetCurrencyCode=function(t,e){this.log("("+t+")"+"Set currencyCode: "+e.currencyCode);var i=this._getAppMeasurementInstance(t);i.currencyCode=e.currencyCode},e.instances={}}var a=t.mixin,n=t.logger,s=window.AppMeasurement,r=i.VisitorBridge;a(e,n),i.AppMeasurementBridge=e,i.appMeasurementBridge=new e}(e),function(t,e){"use strict";function i(t){this.enableLogging("[as-js-bridge::PlayerDelegateAS] > "),this.log("("+t+")"+"Creating player delegate."),this._getSWF=function(t){this.log("("+t+")"+"Looking for SWF object.");var e=document[t]||document.getElementById(t);return e?this.log("Found PSDK player instance: "+t):this.error("Unable to find PSDK player instance: "+t),e},this._swf=this._getSWF(t),this.getVideoInfo=function(){var t;return this._swf&&(t=this._swf.getVideoInfo(),this.log("Video info: "+JSON.stringify(t))),t},this.getAdBreakInfo=function(){var t;return this._swf&&(t=this._swf.getAdBreakInfo(),this.log("Ad-break info: "+JSON.stringify(t))),t},this.getAdInfo=function(){var t;return this._swf&&(t=this._swf.getAdInfo(),this.log("Ad info: "+JSON.stringify(t))),t},this.getChapterInfo=function(){var t;return this._swf&&(t=this._swf.getChapterInfo(),this.log("Chapter info: "+JSON.stringify(t))),t},this.getQoSInfo=function(){var t;return this._swf&&(t=this._swf.getQoSInfo(),this.log("QoS info: "+JSON.stringify(t))),t},this.onError=function(t){this.log("Error info: "+JSON.stringify(t)),this._swf&&this._swf.onError(t)}}function a(){this.enableLogging("[PlayerDelegateBridge] > "),this.onCreate=function(t){this.log("("+t+")"+"Bridge created."),a.instances[t]=new i(t)}}var n=t.mixin,s=t.logger;n(i,s),n(a,s),a.instances={},e.PlayerDelegateBridge=a,e.playerDelegateBridge=new a}(e,i),function(t,e,i){"use strict";function a(){this.enableLogging("[as-js-bridge::VideoHeartbeatBridge] > "),this._getVideoHeartbeatInstance=function(t){var e=a.instances[t];return e||this.error("Unable to find video heartbeat for "+t+"."),e},this._removeVideoHeartbeatInstance=function(t){var e=a.instances[t];return e?(delete a.instances[t],void 0):(this.warn("Cannot remove video heartbeat for "+t+", because it does not exist."),void 0)},this.onCreate=function(t){if(this.log("("+t+")"+"Bridge created."),!a.instances[t]){this.log("("+t+")"+"Creating a VideoHeartbeat instance.");var e=r.instances[t];e||this.error("Unable to find app measurement instance for "+t+".");var i=o.instances[t];i||this.error("Unable to find player delegate for "+t+"."),a.instances[t]=new h(e,i)}},this.onConfigure=function(t,e){this.log("("+t+")"+"Configuring VideoHeartbeat.");var i=this._getVideoHeartbeatInstance(t),a=new c;a.trackingServer=e.trackingServer,a.jobId=e.jobId,a.publisher=e.publisher,a.ovp=e.ovp,a.sdk=e.sdk,a.channel=e.channel,a.debugLogging=e.debugLogging,a.quietMode=e.quietMode,a.__primetime=e.__primetime,a.__psdkVersion=e.__psdkVersion,i.configure(a)},this.onDestroy=function(t){this.log("("+t+")"+"Tearing-down the VideoHeartbeat instance.");var e=this._getVideoHeartbeatInstance(t);e.destroy(),this._removeVideoHeartbeatInstance(t)},this.onTrackVideoLoad=function(t){this.log("("+t+")"+"Track main video load.");var e=this._getVideoHeartbeatInstance(t);e.trackVideoLoad()},this.onTrackVideoUnload=function(t){this.log("("+t+")"+"Track main video close.");var e=this._getVideoHeartbeatInstance(t);e.trackVideoUnload()},this.onTrackPlay=function(t){this.log("("+t+")"+"Track play.");var e=this._getVideoHeartbeatInstance(t);e.trackPlay()},this.onTrackPause=function(t){this.log("("+t+")"+"Track stop.");var e=this._getVideoHeartbeatInstance(t);e.trackPause()},this.onTrackBufferStart=function(t){this.log("("+t+")"+"Track buffer start.");var e=this._getVideoHeartbeatInstance(t);e.trackBufferStart()},this.onTrackBufferComplete=function(t){this.log("("+t+")"+"Track buffer complete.");var e=this._getVideoHeartbeatInstance(t);e.trackBufferComplete()},this.onTrackSeekStart=function(t){this.log("("+t+")"+"Track seek start.");var e=this._getVideoHeartbeatInstance(t);e.trackSeekStart()},this.onTrackSeekComplete=function(t){this.log("("+t+")"+"Track seek complete.");var e=this._getVideoHeartbeatInstance(t);e.trackSeekComplete()},this.onTrackComplete=function(t){this.log("("+t+")"+"Track complete.");var e=this._getVideoHeartbeatInstance(t);e.trackComplete()},this.onTrackChapterStart=function(t){this.log("("+t+")"+"Track chapter start.");var e=this._getVideoHeartbeatInstance(t);e.trackChapterStart()},this.onTrackChapterComplete=function(t){this.log("("+t+")"+"Track chapter complete.");var e=this._getVideoHeartbeatInstance(t);e.trackChapterComplete()},this.onTrackAdBreakStart=function(t){this.log("("+t+")"+"Track ad-break start.");var e=this._getVideoHeartbeatInstance(t);e.trackAdBreakStart()},this.onTrackAdBreakComplete=function(t){this.log("("+t+")"+"Track ad-break complete.");var e=this._getVideoHeartbeatInstance(t);e.trackAdBreakComplete()},this.onTrackAdStart=function(t){this.log("("+t+")"+"Track ad start.");var e=this._getVideoHeartbeatInstance(t);e.trackAdStart()},this.onTrackAdComplete=function(t){this.log("("+t+")"+"Track ad complete.");var e=this._getVideoHeartbeatInstance(t);e.trackAdComplete()},this.onTrackBitrateChange=function(t){var e=this._getVideoHeartbeatInstance(t);e.trackBitrateChange()},this.onTrackVideoPlayerError=function(t,e){this.log("("+t+")"+"Track video-player error.");var i=this._getVideoHeartbeatInstance(t);i.trackVideoPlayerError(e.errorId)},this.onTrackApplicationError=function(t,e){this.log("("+t+")"+"Track application error.");var i=this._getVideoHeartbeatInstance(t);i.trackApplicationError(e.errorId)},a.instances={}}var n=t.mixin,s=t.logger,r=i.AppMeasurementBridge,o=i.PlayerDelegateBridge,h=e.VideoHeartbeat,c=e.ConfigData;n(a,s),t.LOGGING_ENABLED=!0,i.videoHeartbeatBridge=new a}(e,window.ADB.va,i),t.ADB||(t.ADB={}),t.ADB.as_bridge=i})(this);